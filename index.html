<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Assistant (Modular)</title>
    <!-- Link external CSS file -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div id="app"> <!-- Root element for Vue -->
        <div class="app-container">
            <header class="app-header">
                <h1>Smart Assistant (Modular)</h1>
                <!-- –û–±–ª–∞—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è Vue -->
                <div id="notifications" class="notifications">
                    <div v-for="(notification, index) in notifications" :key="index" :class="['notification', notification.type || 'info']">
                        <span>{{ notification.message }}</span>
                        <!-- –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–æ–∫–∞ –±–µ–∑ –ª–æ–≥–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è) -->
                        <button @click="notifications.splice(index, 1)" class="close-notification">&times;</button>
                    </div>
                </div>
            </header>

        <main class="app-main">
            <aside class="sidebar file-explorer">
                <h2>–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h2>
                <div class="directory-controls">
                    <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º @click –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–æ–≤ Vue -->
                    <button @click="renderFileList('/')" title="–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–µ–Ω—å">/ –ö–æ—Ä–Ω–µ–≤–∞—è</button>
                    <button @click="createFile" title="–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ">+</button>
                 </div>
                 <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è Vue -->
                 <div style="word-break: break-all; font-weight: bold; margin: 5px 0; font-size: 0.9em;">{{ currentDirectory }}</div>
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º v-if/v-else/v-for -->
                <ul id="file-list">
                    <li v-if="isLoading" class="loading">{{ loadingMessage || '–ó–∞–≥—Ä—É–∑–∫–∞...' }}</li>
                    <li v-else-if="files.length === 0" class="empty">–ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞</li>
                    <!-- –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –º–∞—Å—Å–∏–≤—É files –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è Vue -->
                    <li v-else v-for="file in files"
                        :key="file.path"
                        :class="['item', file.type, { selected: file.path === selectedFilePath }]"
                        :title="file.path"
                        @click="file.type === 'directory' ? renderFileList(file.path) : loadFile(file.path)">
                        <span class="item-icon">{{ file.type === 'directory' ? 'üìÅ' : 'üìÑ' }}</span>
                        <span>{{ file.name }}</span>
                    </li>
                </ul>
            </aside>

            <section class="content-area">
                <div id="chat-interface" class="chat-interface">
                    <h2>–ß–∞—Ç —Å –ê–≥–µ–Ω—Ç–æ–º (VseGPT API)</h2>
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ -->
                    <div id="chat-history">
                        <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º v-if/v-else –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –∑–∞–≥–ª—É—à–∫–∏ -->
                        <template v-if="chatHistory.length > 0">
                            <div v-for="(message, index) in chatHistory" :key="index" :class="['chat-message', message.sender === 'user' ? 'user' : 'agent']">
                                <div class="sender">{{ message.sender === 'user' ? '–í—ã' : '–ê–≥–µ–Ω—Ç' }}</div>
                                <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º v-html –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å markdown, –∏–Ω–∞—á–µ {{ message.text }} -->
                                <div class="message-content">{{ message.text }}</div>
                                <div class="timestamp">{{ message.timestamp ? Utils.formatTimestamp(message.timestamp) : '' }}</div>
                            </div>
                        </template>
                        <div v-else class="chat-message agent">
                             <div class="sender">–ê–≥–µ–Ω—Ç</div>
                             <div>–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –ø—É—Å—Ç–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —á–∞—Ç –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ.</div>
                        </div>
                    </div>
                     <!-- –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ file-viewer -->
                </div>

                <div id="file-viewer" class="file-viewer">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                       <h2 style="margin: 0;">–ü—Ä–æ—Å–º–æ—Ç—Ä / –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                       <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å —Ñ–∞–π–ª–∞ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è Vue -->
                       <span>{{ fileStatus }}</span>
                   </div>
                    <!-- –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
                    <div id="file-info">
                        <span v-if="selectedFilePath">–§–∞–π–ª: {{ selectedFilePath }}</span>
                        <span v-else>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
                    </div>
                    <!-- –°–≤—è–∑—ã–≤–∞–µ–º textarea —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º Vue —á–µ—Ä–µ–∑ v-model –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–≤–æ–¥ -->
                    <textarea
                        id="file-content-editor"
                        placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —á–∞—Ç–∞..."
                        v-model="editorContent"
                        @input="handleEditorInput"
                        :disabled="isLoading"
                    ></textarea>
                    <!-- –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ –∏ –¥–µ–π—Å—Ç–≤–∏–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –º–µ—Ç–æ–¥–∞–º –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—é Vue -->
                    <div class="combined-input-actions">
                         <!-- –ö–Ω–æ–ø–∫–∞ –û—Ç–ø—Ä–∞–≤–∏—Ç—å: –∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ -->
                         <button @click="sendMessage" :disabled="!editorContent.trim() || isLoading">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                         <!-- –ö–Ω–æ–ø–∫–∞ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å: –∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ñ–∞–π–ª, –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —ç—Ç–æ –Ω–µ —á–∞—Ç -->
                         <button @click="saveFile" :disabled="!selectedFilePath || !isEditorDirty || isLoading || (selectedFilePath && selectedFilePath.startsWith('/chats/'))">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                         <!-- –ö–Ω–æ–ø–∫–∞ –£–¥–∞–ª–∏—Ç—å: –∞–∫—Ç–∏–≤–Ω–∞, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ñ–∞–π–ª -->
                         <button @click="deleteFile" :disabled="!selectedFilePath || isLoading">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                     <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ -->
                     <div v-if="lastLoadedAgentConfig" class="config-display">
                        <h3>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ê–∫—Ç–∏–≤–Ω–æ–≥–æ –ê–≥–µ–Ω—Ç–∞: {{ lastLoadedAgentConfig.name || '–ë–µ–∑ –∏–º–µ–Ω–∏' }}</h3>
                        <pre>{{ JSON.stringify(lastLoadedAgentConfig, null, 2) }}</pre>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer removed -->
    </div>

    <!-- Import Vue.js via CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Import the main JavaScript module -->
    <script type="module" src="js/main.js"></script>
    </div> <!-- Close #app -->
</body>
</html>
